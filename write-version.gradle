// depends on https://github.com/palantir/gradle-git-version

task writeVersion(type: WriteVersionTask) {
    versionFile = "$projectDir/src/main/resources/version.properties"
}

class WriteVersionTask extends DefaultTask {
    def versionFile

    File getVersionFile() {
        project.file(versionFile)
    }

    String getDescription() {
        "Writes the current git version to a specified file (e.g. <project>/src/main/resources/version.properties)."
    }

    @TaskAction
    def writeToFile() {
        getVersionFile().getParentFile().mkdirs()
        getVersionFile().text = "productVersion: " + project.version
    }
}

